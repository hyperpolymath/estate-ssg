// SPDX-License-Identifier: AGPL-3.0-or-later
= estate-ssg Handover Specification
:toc: left
:toclevels: 2
:sectnums:

== Project Identity

[cols="1,3"]
|===
|Property |Value

|Name |estate-ssg
|Language |Forth (gforth)
|Type |Static Site Generator
|Ecosystem |poly-ssg satellite
|License |AGPL-3.0-or-later
|===

== Critical Constraints

IMPORTANT: These constraints are NON-NEGOTIABLE.

1. **Language Requirement**: The engine MUST be written in Forth
2. **No Rewrites**: NEVER suggest rewriting in Python, JavaScript, or any other language
3. **Single Exception**: Only the MCP adapter (in `adapters/`) may use ReScript
4. **Zero Dependencies**: Beyond gforth itself, no external dependencies

== Repository Structure

----
estate-ssg/
├── src/
│   └── forth-estate.fs      # Main Forth engine (926 lines)
├── adapters/
│   └── src/
│       └── EstateAdapter.res # MCP adapter (ReScript)
├── .github/
│   └── workflows/
│       ├── ci.yml           # Forth CI pipeline
│       └── codeql.yml       # Security scanning
├── .well-known/
│   ├── security.txt         # RFC 9110 security contact
│   └── aibdp.json           # AI boundary declaration
├── META.scm                  # Architecture decisions
├── STATE.scm                 # Project status
├── ECOSYSTEM.scm             # Ecosystem position
├── PLAYBOOK.scm              # Development workflow
├── AGENTIC.scm               # AI agent guidelines
├── NEUROSYM.scm              # Neurosymbolic integration
├── ROADMAP.scm               # Development roadmap
├── Justfile                  # Build automation
├── Mustfile                  # Mandatory checks
├── cookbook.adoc             # Comprehensive guide
└── Containerfile             # Container image
----

== Core Components

=== Forth Engine (`src/forth-estate.fs`)

[cols="1,2"]
|===
|Section |Words

|String Utilities |`trim`, `trim-left`, `trim-right`, `string=`, `starts-with?`
|Dynamic Buffer |`init-output`, `append-output`, `get-output`, `free-output`
|Frontmatter Parser |`parse-frontmatter`, `parse-fm-line`, `clear-frontmatter`
|Markdown Parser |`parse-markdown`, `process-line`, `process-header`, `process-inline`
|Template System |`apply-template`, `default-template`, `find-placeholder`
|File I/O |`read-file-contents`, `write-file-contents`, `ensure-dir`
|Build System |`build-site`, `process-file`, `build`
|Testing |`test-buffer`, `test-markdown`, `test-frontmatter`, `test-full`
|===

=== MCP Adapter (`adapters/src/EstateAdapter.res`)

[cols="1,2"]
|===
|Tool |Description

|`estate_build` |Build site via gforth
|`estate_clean` |Clean output directory
|`estate_version` |Get version info
|===

== Development Workflow

=== Quick Start

[source,bash]
----
# Setup
just setup

# Check syntax
just check

# Run tests
just test

# Build site
just build

# Interactive REPL
just repl
----

=== CI/CD

The CI pipeline validates:

1. Forth syntax (gforth can load the file)
2. Language compliance (no forbidden files in src/)
3. Tests pass
4. CodeQL security scan (for adapters)

== Testing

=== REPL Testing

[source,bash]
----
gforth src/forth-estate.fs
test-buffer       \ Test buffer operations
test-markdown     \ Test markdown parsing
test-frontmatter  \ Test YAML parsing
test-full         \ Full pipeline test
----

=== Automated Testing

[source,bash]
----
just test         # Unit tests
just test-e2e     # End-to-end tests
just test-all     # All tests
----

== Security

- Security policy: `SECURITY.md`
- Contact: security@hyperpolymath.org
- Scanning: CodeQL via GitHub Actions
- Secrets: Never committed, use environment variables

== Known Limitations

1. No link/image parsing in markdown (planned v1.2)
2. No incremental builds (planned v2.0)
3. No watch mode (planned v2.0)
4. Directory traversal requires shell integration

== Handover Checklist

When handing over this project:

* [ ] Verify gforth is installed: `gforth --version`
* [ ] Run all tests: `just test-all`
* [ ] Check CI status: GitHub Actions
* [ ] Review STATE.scm for current status
* [ ] Review ROADMAP.scm for planned work
* [ ] Familiarize with cookbook.adoc
